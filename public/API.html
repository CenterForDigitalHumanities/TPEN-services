<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>TPEN Services API Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #e0e0e0;
            }
            .endpoint {
                background-color: #2a2a2a;
                border-left-color: #4a9eff;
            }
            code {
                background-color: #2a2a2a;
                color: #e0e0e0;
            }
            pre {
                background-color: #2a2a2a;
                border-color: #444;
            }
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        @media (prefers-color-scheme: dark) {
            h1 { color: #4a9eff; border-bottom-color: #4a9eff; }
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 5px;
        }
        @media (prefers-color-scheme: dark) {
            h2 { color: #9bb3d1; border-bottom-color: #444; }
        }
        h3 {
            color: #16a085;
            margin-top: 30px;
        }
        @media (prefers-color-scheme: dark) {
            h3 { color: #52c4a8; }
        }
        h4 {
            color: #e74c3c;
            margin-top: 25px;
            font-size: 1.1em;
        }
        @media (prefers-color-scheme: dark) {
            h4 { color: #ff6b6b; }
        }
        .endpoint {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 0.85em;
            margin-right: 10px;
        }
        .post { background-color: #28a745; color: white; }
        .get { background-color: #007bff; color: white; }
        .put { background-color: #ffc107; color: black; }
        .delete { background-color: #dc3545; color: white; }
        .auth-required {
            display: inline-block;
            padding: 2px 6px;
            background-color: #ff9800;
            color: white;
            border-radius: 3px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        @media (prefers-color-scheme: dark) {
            .toc {
                background-color: #2a2a2a;
                border-color: #444;
            }
        }
        .toc ul {
            margin: 0;
            padding-left: 20px;
        }
        .toc a {
            text-decoration: none;
            color: #3498db;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        @media (prefers-color-scheme: dark) {
            .toc a { color: #4a9eff; }
        }
        .base-url {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        @media (prefers-color-scheme: dark) {
            .base-url {
                background-color: #1a2a1a;
                border-left-color: #52c4a8;
            }
        }
        .response-codes {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .response-code {
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 3px;
            text-align: center;
            min-width: 60px;
        }
        .code-200 { background-color: #d4edda; color: #155724; }
        .code-201 { background-color: #d4edda; color: #155724; }
        .code-204 { background-color: #d4edda; color: #155724; }
        .code-400 { background-color: #f8d7da; color: #721c24; }
        .code-401 { background-color: #f8d7da; color: #721c24; }
        .code-403 { background-color: #f8d7da; color: #721c24; }
        .code-404 { background-color: #f8d7da; color: #721c24; }
        .code-405 { background-color: #f8d7da; color: #721c24; }
        .code-500 { background-color: #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <h1>TPEN Services API Documentation</h1>
    
    <p>This document provides an overview of the available routes in the TPEN Services API. These routes allow interaction with the application for various functionalities.</p>

    <div class="base-url">
        <h3>Base URL</h3>
        <ul>
            <li><strong>Production</strong>: <a href="https://api.t-pen.org">https://api.t-pen.org</a></li>
            <li><strong>Development</strong>: <a href="https://dev.api.t-pen.org">https://dev.api.t-pen.org</a></li>
        </ul>
    </div>

    <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
            <li><a href="#authentication">1. Authentication</a></li>
            <li><a href="#project">2. Project</a></li>
            <li><a href="#collaborators">3. Collaborators</a></li>
            <li><a href="#users">4. Users</a></li>
            <li><a href="#layers">5. Layers</a></li>
        </ul>
    </div>

    <h2 id="authentication">1. Authentication</h2>
    
    <p>Endpoints marked with <span class="auth-required">üîê</span> require authentication and expect a valid JWT token in the <code>Authorization</code> header. Use the <a href="https://three.t-pen.org/login/">public TPEN3 login</a> to get one of these JWT tokens.</p>

    <h2 id="project">2. Project</h2>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/project/create <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Create a new project. This is a high-skill maneuver requiring a complete project object.</p>
        
        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "label": "string",
    "metadata": [ { Metadata } ],
    "layers": [ { Layer } ],
    "manifests": [ "URIs&lt;Manifest&gt;" ],
    "creator": "URI&lt;Agent&gt;",
    "group": "hexstring"
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-201">201</span>
            <span>Project created successfully</span>
            <span class="response-code code-400">400</span>
            <span>Project creation failed, validation errors</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: The Location header of a successful response contains the Project ID.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/import?createFrom="URL" <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Create a new project by importing a web resource.</p>
        
        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "url": "URL&lt;IIIF:Manifest&gt;"
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-201">201</span>
            <span>Project created successfully</span>
            <span class="response-code code-400">400</span>
            <span>Project creation failed, validation errors</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: The Location header contains the Project ID. The project will be created with the label and metadata of the imported resource.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method get">GET</span>/project/:id <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Retrieve a project by ID.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>id</code>: ID of the project</li>
        </ul>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Project found</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-403">403</span>
            <span>Forbidden</span>
            <span class="response-code code-404">404</span>
            <span>Project not found</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "id": "string",
    "label": "string",
    "metadata": [ { Metadata } ],
    "creator": "URI&lt;Agent&gt;",
    "layers": [ { Layer } ],
    "manifests": [ "URIs&lt;Manifest&gt;" ],
    "group": "hexstring",
    "tools": [ "string" ],
    "options": { OptionsMap }
}</code></pre>
        <p><em>Note: The response is not a complete Project data object, but a projection designed for use in the client interface.</em></p>
    </div>

    <h2 id="collaborators">3. Collaborators</h2>
    <p>Manage the users and roles in a Project.</p>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/project/:projectId/invite-member <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Invite a user to a project. If the user does not have a TPEN account, they will be sent an email invitation.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project as a hexstring or the Project slug</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "email": "string",
    "roles": ["string"] | "string"
}</code></pre>
        <ul>
            <li><code>email</code>: The email address of the user to invite</li>
            <li><code>roles</code>: The roles of the user in the project as an array or space-delimited string</li>
        </ul>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>User invited successfully</span>
            <span class="response-code code-400">400</span>
            <span>User invitation failed, validation errors</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-403">403</span>
            <span>Forbidden</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: This API is not able to track the status of the invitation. Email addresses that fail to be delivered or are rejected by the recipient will not be reported.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/project/:projectId/remove-member <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Remove a user from a project group.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "userID": "string"
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-204">204</span>
            <span>User removed successfully</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-403">403</span>
            <span>Forbidden</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: This removes a user and their roles from the project. The user will no longer have access to the project, but their annotations will remain with full attribution.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method put">PUT</span>/project/:projectId/collaborator/:collaboratorId/setRoles <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Set the roles of a User in a project, replacing all currently defined roles.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
            <li><code>collaboratorId</code>: ID of the collaborator</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "roles": ["string"] | "string"
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Roles set successfully</span>
            <span class="response-code code-400">400</span>
            <span>Roles setting failed, validation errors</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-403">403</span>
            <span>Forbidden</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: The User requesting this action must have permissions to set roles for the collaborator. The OWNER role cannot be set using this endpoint.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/project/:projectId/switch/owner <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Transfer ownership of a project to another user.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "newOwnerId": "hexstring"
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Ownership transferred successfully</span>
            <span class="response-code code-400">400</span>
            <span>Ownership transfer failed, validation errors</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-403">403</span>
            <span>Forbidden</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: The User requesting this action must be the current owner of the project. The OWNER role will be removed from the current owner and assigned to the new owner. The new owner must be a member of the project. If the current owner has no other roles, the CONTRIBUTOR role will be assigned to them.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/project/:projectId/setCustomRoles <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Set custom roles for a Project group. Custom roles must be provided as a JSON object with keys as roles and values as arrays of permissions or space-delimited strings.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "roles": {
        "roleName": ["permission1", "permission2"] | "space-delimited permissions"
    }
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Custom roles set successfully</span>
            <span class="response-code code-400">400</span>
            <span>Invalid request, validation errors</span>
            <span class="response-code code-401">401</span>
            <span>Unauthenticated request</span>
            <span class="response-code code-403">403</span>
            <span>Permission denied</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>
        <p><em>Note: The User requesting this action must have permissions to update roles. Default roles cannot be modified using this endpoint. Custom roles can be complicated and there is more detailed description of their use in the Cookbook.</em></p>
    </div>

    <h2 id="users">4. Users</h2>
    <p>Private account modification, personal details, and public profile retrieval.</p>

    <div class="endpoint">
        <h4><span class="method get">GET</span>/my/profile <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Retrieve the profile of the authenticated user.</p>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Profile found</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "_id": "hexstring",
    "_sub": "string",
    "agent": "URI&lt;Agent&gt;",
    "email": "string",
    "profile": {
        "displayName": "string",
        "custom": Any
    },
    "name": "string"
}</code></pre>
        <p><em>Note: Users can always see and manipulate their own profile. The profile object is a projection of the full user object.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method get">GET</span>/my/projects <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Retrieve a list of projects the authenticated user is a member of.</p>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Projects found</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>[
    {
        "_id": "hexstring",
        "label": "string",
        "roles": ["string"]
    }, ...
]</code></pre>
        <p><em>Note: The response is a list of projects the user is a member of regardless of the permissions afforded to them in each project.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method get">GET</span>/user/:id</h4>
        <p><strong>Description:</strong> Retrieve the public profile of a user.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>id</code>: ID of the user</li>
        </ul>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Profile found</span>
            <span class="response-code code-404">404</span>
            <span>Profile not found</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "_id": "hexstring",
    "displayName": "string",
    "custom": Any
}</code></pre>
        <p><em>Note: The response is a projection of the full user object. The public profile is available to all users and serialized into this response with whatever the user has chosen to share. The custom field is not an actual property - it is a placeholder for any additional fields the user has added to their profile. The displayName and _id fields are always present.</em></p>
    </div>

    <h2 id="layers">5. Layers</h2>

    <div class="endpoint">
        <h4><span class="method post">POST</span>/project/:projectId/layer <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Create a new layer within a project.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "label": "string",
    "canvases": ["string"]
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-201">201</span>
            <span>Layer created successfully</span>
            <span class="response-code code-400">400</span>
            <span>Invalid input</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-404">404</span>
            <span>Project not found</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "id": "string",
    "label": "string",
    "pages": ["string"]
}</code></pre>
        <p><em>Note: Requests without at least one canvas are considered invalid.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method put">PUT</span>/project/:projectId/layer/:layerId <span class="auth-required">üîê</span></h4>
        <p><strong>Description:</strong> Update an existing layer within a project.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
            <li><code>layerId</code>: ID of the layer</li>
        </ul>

        <p><strong>Request Body:</strong></p>
        <pre><code>{
    "label": "string",
    "canvases": ["string"]
}</code></pre>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Layer updated successfully</span>
            <span class="response-code code-400">400</span>
            <span>Invalid input</span>
            <span class="response-code code-401">401</span>
            <span>Unauthorized</span>
            <span class="response-code code-404">404</span>
            <span>Layer or project not found</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "id": "string",
    "label": "string",
    "pages": ["string"]
}</code></pre>
        <p><em>Note: You may not empty the canvases of an existing layer. If the canvases property is an empty array the request will be treated as if it did not contain the canvases property at all.</em></p>
    </div>

    <div class="endpoint">
        <h4><span class="method get">GET</span>/project/:projectId/layer/:layerId</h4>
        <p><strong>Description:</strong> Get an existing layer within a project.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
            <li><code>layerId</code>: ID of the layer</li>
        </ul>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Layer found</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "@context": "string",
    "id": "string",
    "type": "AnnotationCollection",
    "label": {
        "none":[
            "TPEN3 Layer"
        ]
    },
    "total": "integer",
    "first": "string",
    "last": "string"
}</code></pre>
    </div>

    <div class="endpoint">
        <h4><span class="method get">GET</span>/project/:projectId/layer/:layerId/page/:pageid</h4>
        <h4><span class="method get">GET</span>/project/:projectId/page/:pageid</h4>
        <p><strong>Description:</strong> Get an existing page within a project.</p>
        
        <p><strong>Parameters:</strong></p>
        <ul>
            <li><code>projectId</code>: ID of the project</li>
            <li><code>layerId</code>: Optional. ID of the layer</li>
            <li><code>pageId</code>: The ID of the page</li>
        </ul>

        <p><strong>Responses:</strong></p>
        <div class="response-codes">
            <span class="response-code code-200">200</span>
            <span>Page found</span>
            <span class="response-code code-500">500</span>
            <span>Server error</span>
        </div>

        <p><strong>Success Response Example:</strong></p>
        <pre><code>{
    "@context": "string",
    "id": "string",
    "type": "AnnotationPage",
    "label": {
        "none":[
            "TPEN3 Page"
        ]
    },
    "target": "string",
    "items":[ {"type": "Canvas"} ],
    "prev": "string",
    "next": "string"
}</code></pre>
    </div>

    <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666;">
        <p>TPEN Services API Documentation | Generated from API.md</p>
    </footer>
</body>
</html>